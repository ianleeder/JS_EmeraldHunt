<!DOCTYPE html>
<html>
	<head>
		<link rel="shortcut icon" type="image/x-icon" href="images/hunt.ico" />
		<title>Emerald Hunt</title>
	</head>
	<body>
		<h1>My Emerald Hunt clone</h1>
		<label for="scale">Choose a scale:</label>
		<select id="scale">
			<option value="1">100%</option>
			<option value="1.1">110%</option>
			<option value="1.2" selected="selected">120%</option>
			<option value="1.3">130%</option>
			<option value="1.4">140%</option>
			<option value="1.5">150%</option>
		</select><br/>
		<canvas id="huntCanvas">
			This browser can not run this game (canvas support missing).
		</canvas>
		<br><br>
		<hr>
		<h3>Resource (image) file</h3>
		<span>Upload file: </span>
		<input type="file" id="resource-file-input" />
		<div id="imagesDiv"></div>
		<hr>
		<h3>Save game analysis</h3>
		<pre id="file-content"></pre>
		<hr>
		<h3>Screenshot analysis</h3>
		<span>Upload screenshot: </span>
		<input type="file" id="screenshot-file-input" />
		<pre id="screenshot-content"></pre>
	</body>
</html>

<script type="module">
	import {EmeraldHunt} from "./js/hunt.js";
	import {ScreenshotAnalyser} from "./js/screenshot.js";

	window.onload = init;
	var app;
	
	async function init() {
		let canvas = document.getElementById("huntCanvas");
		canvas.focus();
		app = new EmeraldHunt(canvas);

		let scale = document.getElementById('scale');
		scale.addEventListener('change', changeScale, false);
		// https://stackoverflow.com/a/23612498/5329728
		scale.dispatchEvent(new Event('change'));
		await app.init();

		document.getElementById('resource-file-input').addEventListener('change', uploadResourceFile);
		document.getElementById('screenshot-file-input').addEventListener('change', uploadScreenshot);
	};

	async function uploadResourceFile(event) {
		const file = event.target.files[0];
		console.log(file);
		await app.useImageFile(file);
	}

	async function uploadScreenshot(event) {
		let canvas = document.getElementById("huntCanvas");
		let analyser = new ScreenshotAnalyser(canvas, document.getElementById('screenshot-content'));

		const file = event.target.files[0];
		console.log(file);
		analyser.loadImage(file);
	}

	function changeScale(e) {
		app.scaleGame(e.target.value);
	}
</script>